{"componentChunkName":"component---src-templates-note-template-tsx","path":"/ecto/transactions","result":{"data":{"markdownRemark":{"html":"<ul>\n<li>runs in order</li>\n<li>only unhandled errors will trigger a rollback</li>\n<li>use Repo functions that raises an error (<code class=\"language-text\">insert!</code>)</li>\n<li>if you have a non database operation, put it at the end</li>\n<li>hard to track errors when an operation fail</li>\n<li>transactions might be a good fit if you're only running a small number of operations\nand you don't need to track which operation failed</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"elixir\"><pre class=\"language-elixir\"><code class=\"language-elixir\">user <span class=\"token operator\">=</span> User<span class=\"token punctuation\">.</span>changeset<span class=\"token punctuation\">(</span><span class=\"token punctuation\">%</span>User<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">%</span><span class=\"token punctuation\">{</span><span class=\"token attr-name\">firstname:</span> <span class=\"token string\">\"Tony\"</span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">lastname:</span> <span class=\"token string\">\"Stark\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\nprofile <span class=\"token operator\">=</span> Profile<span class=\"token punctuation\">.</span>changeset<span class=\"token punctuation\">(</span><span class=\"token punctuation\">%</span>Profile<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">%</span><span class=\"token punctuation\">{</span><span class=\"token attr-name\">role:</span> <span class=\"token string\">\"avenger\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># rollbacks any changes since user_id is required when creating profile</span>\nRepo<span class=\"token punctuation\">.</span>transaction<span class=\"token punctuation\">(</span><span class=\"token keyword\">fn</span> <span class=\"token operator\">-></span>\n  Repo<span class=\"token punctuation\">.</span>insert!<span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>\n  Repo<span class=\"token punctuation\">.</span>insert!<span class=\"token punctuation\">(</span>profile<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span><span class=\"token punctuation\">)</span></code></pre></div>","frontmatter":{"date":"March 12, 2021","path":"/ecto/transactions","title":"Transactions","category":"Ecto"}}},"pageContext":{}}}